{% extends 'main/dashboard_base.html' %}
{% load static %}

{% block title %}إنشاء دورة جديدة{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/course-creation.css' %}">
<script src="{% static 'js/course-image-upload.js' %}"></script>
<script src="{% static 'js/course-creation.js' %}"></script>
{% endblock %}

{% block dashboard_content %}

    <div class="col-lg-8">
      <div class="card shadow-lg border-0 mb-5">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #1d3b53 0%, #2a5a7c 100%);">
          <h2 class="mb-0 text-center">
            <i class="fas fa-plus-circle me-2"></i> إنشاء دورة جديدة
          </h2>
        </div>
        <div class="card-body p-4">
          <form id="course-form" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
            {% csrf_token %}
            <input type="hidden" name="teacher_id" value="{{ request.user.teacher.id }}">
            
            <!-- Step Progress Bar -->
            <div id="stepper" class="d-flex justify-content-between mb-5">
              <div class="step-line"></div>
              <div class="step-item active">
                <div class="step-circle">1</div>
                <div class="text-center mt-2">معلومات الدورة</div>
              </div>
              <div class="step-item">
                <div class="step-circle">2</div>
                <div class="text-center mt-2">الموديولات</div>
              </div>
              <div class="step-item">
                <div class="step-circle">3</div>
                <div class="text-center mt-2">المراجعة</div>
              </div>
            </div>
            
            <!-- Step 1: Course Info -->
            <div class="step-card">
              <h4 class="mb-4 text-primary">معلومات الدورة الأساسية</h4>
              
              <div class="mb-3">
                <label class="form-label fw-bold">عنوان الدورة</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-book text-primary"></i></span>
                  <input type="text" class="form-control" name="name" required placeholder="أدخل عنوان الدورة">
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">وصف مختصر</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-align-left text-primary"></i></span>
                  <input type="text" class="form-control" name="small_description" placeholder="ملخص يظهر في بطاقة الدورة">
                </div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">السعر ($)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light">$</span>
                    <input type="number" class="form-control" name="price" step="0.01" min="0" placeholder="0.00" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">مستوى الدورة</label>
                  <select class="form-select" name="level" required>
                    <option value="">-- اختر المستوى --</option>
                    <option value="beginner">مبتدئ</option>
                    <option value="intermediate">متوسط</option>
                    <option value="advanced">متقدم</option>
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">صورة الدورة</label>
                <div class="card border-dashed p-3 text-center" style="cursor: pointer;" onclick="document.getElementById('image_course').click()">
                  <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-2"></i>
                  <h5 class="text-muted">انقر لتحميل صورة</h5>
                  <p class="small text-muted">الحجم الموصى به: 800x450 بكسل</p>
                  <input type="file" class="d-none" id="image_course" name="image_course" accept="image/*">
                </div>
              </div>
              
              <!-- PDF Upload Fields -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">ملف المنهج (PDF)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light"><i class="fas fa-file-pdf text-primary"></i></span>
                    <input type="file" class="form-control" name="syllabus_pdf" accept="application/pdf">
                  </div>
                  <div class="form-text">تحميل ملف المنهج التفصيلي للدورة (اختياري)</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">مواد إضافية (PDF)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light"><i class="fas fa-file-pdf text-primary"></i></span>
                    <input type="file" class="form-control" name="materials_pdf" accept="application/pdf">
                  </div>
                  <div class="form-text">تحميل مواد إضافية للدورة (اختياري)</div>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">الوصف التفصيلي</label>
                <textarea class="form-control" name="description" rows="5" required placeholder="اشرح محتوى الدورة بشكل تفصيلي..."></textarea>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">ما الذي سيتعلمه الطالب؟</label>
                <textarea class="form-control" name="learned" rows="5" placeholder="أدخل كل نقطة في سطر منفصل..."></textarea>
                <div class="form-text">ضع كل نقطة تعلم في سطر جديد</div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">فئة الدورة</label>
                  <select class="form-select" name="category">
                    <option value="">-- اختر الفئة --</option>
                    {% for cat in categories %}
                      <option value="{{ cat.id }}">{{ cat.name }}</option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">المؤسسة</label>
                  <select class="form-select" name="organization">
                    <option value="">-- اختر المؤسسة --</option>
                    {% for org in organizations %}
                      <option value="{{ org.id }}">{{ org.name }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">وسوم الدورة</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-tags text-primary"></i></span>
                  <input type="text" class="form-control" name="tags" placeholder="برمجة، تطوير، تصميم (افصل بينهم بفاصلة)">
                </div>
              </div>
              
              <div class="d-flex justify-content-end mt-4">
                <button type="button" class="btn btn-primary px-4" onclick="nextStep()">
                  التالي <i class="fas fa-arrow-left ms-2"></i>
                </button>
              </div>
            </div>
            
            <!-- Step 2: Modules -->
            <div class="step-card d-none">
              <h4 class="mb-4 text-primary">موديولات الدورة</h4>
              
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                أضف موديولات للدورة. يمكنك إضافة فيديوهات وملاحظات واختبارات لكل موديول.
              </div>
              
              <div id="modules-container">
                <!-- Modules will be added here -->
              </div>
              
              <div class="d-flex justify-content-center my-4">
                <button type="button" class="btn btn-success" id="add-module-btn">
                  <i class="fas fa-plus me-2"></i> إضافة موديول جديد
                </button>
              </div>
              
              <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary px-4" onclick="prevStep()">
                  <i class="fas fa-arrow-right me-2"></i> السابق
                </button>
                <button type="button" class="btn btn-primary px-4" onclick="nextStep()">
                  التالي <i class="fas fa-arrow-left ms-2"></i>
                </button>
              </div>
            </div>
            
            <!-- Step 3: Review -->
            <div class="step-card d-none">
              <h4 class="mb-4 text-primary">مراجعة الدورة</h4>
              
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                راجع معلومات الدورة قبل الحفظ. تأكد من إضافة جميع المعلومات المطلوبة.
              </div>
              
              <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary px-4" onclick="prevStep()">
                  <i class="fas fa-arrow-right me-2"></i> السابق
                </button>
                <button type="button" class="btn btn-success px-4" id="submit-course-btn">
                  <i class="fas fa-save me-2"></i> حفظ الدورة
                </button>
              </div>
            </div>
            
          </form>
        </div>
      </div>
    </div>

{% endblock dashboard_content %}