{% extends 'main/dashboard_base.html' %}
{% load static %}

{% block title %}إنشاء دورة جديدة{% endblock %}

{% block head %}
<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="{% static 'css/course-creation.css' %}">
<script src="{% static 'js/course-image-upload.js' %}"></script>
<script src="{% static 'js/course-creation.js' %}"></script>
{% endblock %}

{% block dashboard_content %}

    <div class="col-lg-8">
      <div class="card shadow-lg border-0 mb-5">
        <div class="card-header text-white" style="background: linear-gradient(135deg, #1d3b53 0%, #2a5a7c 100%);">
          <h2 class="mb-0 text-center">
            <i class="fas fa-plus-circle me-2"></i> إنشاء دورة جديدة
          </h2>
        </div>
        <!-- Add alerts container -->
        <div id="alerts-container" class="mt-2"></div>
        <div class="card-body p-4">
          <form id="course-form" method="post" enctype="multipart/form-data" class="needs-validation" accept-charset="utf-8" novalidate>
            {% csrf_token %}
            <input type="hidden" name="teacher_id" value="{{ request.user.teacher.id }}">
            
            <!-- Step Progress Bar -->
            <div id="stepper" class="d-flex justify-content-between mb-5">
              <div class="step-line"></div>
              <div class="step-item active">
                <div class="step-circle">1</div>
                <div class="text-center mt-2">معلومات الدورة</div>
              </div>
              <div class="step-item">
                <div class="step-circle">2</div>
                <div class="text-center mt-2">الموديولات</div>
              </div>
              <div class="step-item">
                <div class="step-circle">3</div>
                <div class="text-center mt-2">المراجعة</div>
              </div>
            </div>
            
            <!-- Step 1: Course Info -->
            <div class="step-card">
              <h4 class="mb-4 text-primary">معلومات الدورة الأساسية</h4>
              
              <div class="mb-3">
                <label class="form-label fw-bold">عنوان الدورة</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-book text-primary"></i></span>
                  <input type="text" class="form-control" name="name" required placeholder="أدخل عنوان الدورة">
                </div>
                <div class="invalid-feedback">يرجى إدخال عنوان للدورة</div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">وصف مختصر</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-align-left text-primary"></i></span>
                  <input type="text" class="form-control" name="small_description" required placeholder="ملخص يظهر في بطاقة الدورة">
                </div>
                <div class="invalid-feedback">يرجى إدخال وصف مختصر للدورة</div>
              </div>
              
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">السعر ($)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light">$</span>
                    <input type="number" class="form-control" name="price" step="0.01" min="0" placeholder="0.00" required>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">مستوى الدورة</label>
                  <select class="form-select" name="level" required>
                    <option value="">-- اختر المستوى --</option>
                    <option value="beginner">مبتدئ</option>
                    <option value="intermediate">متوسط</option>
                    <option value="advanced">متقدم</option>
                  </select>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">صورة الدورة</label>
                <div class="card border-dashed p-3 text-center" style="cursor: pointer;" onclick="document.getElementById('image_course').click()">
                  <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-2"></i>
                  <h5 class="text-muted">انقر لتحميل صورة</h5>
                  <p class="small text-muted">الحجم الموصى به: 800x450 بكسل</p>
                  <input type="file" class="d-none" id="image_course" name="image_course" accept="image/*">
                </div>
              </div>
              
              <!-- PDF Upload Fields -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label fw-bold">ملف المنهج (PDF)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light"><i class="fas fa-file-pdf text-primary"></i></span>
                    <input type="file" class="form-control" name="syllabus_pdf" accept="application/pdf">
                  </div>
                  <div class="form-text">تحميل ملف المنهج التفصيلي للدورة (اختياري)</div>
                </div>
                <div class="col-md-6">
                  <label class="form-label fw-bold">مواد إضافية (PDF)</label>
                  <div class="input-group">
                    <span class="input-group-text bg-light"><i class="fas fa-file-pdf text-primary"></i></span>
                    <input type="file" class="form-control" name="materials_pdf" accept="application/pdf">
                  </div>
                  <div class="form-text">تحميل مواد إضافية للدورة (اختياري)</div>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">الوصف الكامل</label>
                <textarea class="form-control" name="description" rows="5" required placeholder="وصف تفصيلي للدورة"></textarea>
                <div class="invalid-feedback">يرجى إدخال وصف كامل للدورة</div>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">ما الذي سيتعلمه الطالب؟</label>
                <textarea class="form-control" name="learned" rows="5" placeholder="أدخل كل نقطة في سطر منفصل..."></textarea>
                <div class="form-text">ضع كل نقطة تعلم في سطر جديد</div>
              </div>
              
              <div class="row mb-3">
                <div class="mb-3">
                <label class="form-label fw-bold">التصنيف</label>
                <select class="form-select" name="category" required>
                  <option value="">-- اختر التصنيف --</option>
                  {% for category in categories %}
                  <option value="{{ category.id }}">{{ category.name }}</option>
                  {% endfor %}
                </select>
                <div class="invalid-feedback">يرجى اختيار تصنيف للدورة</div>
              </div>
               <!--  <div class="col-md-6">
                  <label class="form-label fw-bold">المؤسسة</label>
                  <select class="form-select" name="organization">
                    <option value="">-- اختر المؤسسة --</option>
                    {% for org in organizations %}
                      <option value="{{ org.id }}">{{ org.name }}</option>
                    {% endfor %}
                  </select>
                </div> -->
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">وسوم الدورة</label>
                <div class="input-group">
                  <span class="input-group-text bg-light"><i class="fas fa-tags text-primary"></i></span>
                  <input type="text" class="form-control" name="tags" placeholder="برمجة، تطوير، تصميم (افصل بينهم بفاصلة)">
                </div>
              </div>
              
              <div class="d-flex justify-content-end mt-4">
                <button type="button" class="btn btn-primary px-4" onclick="nextStep()">
                  التالي <i class="fas fa-arrow-left ms-2"></i>
                </button>
              </div>
            </div>
            
            <!-- Step 2: Modules -->
            <div class="step-card d-none">
              <h4 class="mb-4 text-primary">موديولات الدورة</h4>
              
              <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                أضف موديولات للدورة. يمكنك إضافة فيديوهات وملفات PDF وملاحظات واختبارات لكل موديول.
              </div>
              
              <div id="modules-container">
                <!-- Modules will be added here -->
                <!-- Module Template (Hidden) -->
                <template id="module-template">
                  <div class="card mb-4 module-card">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                      <h5 class="mb-0"><i class="fas fa-layer-group text-primary me-2"></i>الموديول</h5>
                      <button type="button" class="btn btn-sm btn-outline-danger remove-module-btn">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                    <div class="card-body">
                      <div class="mb-3">
                        <label class="form-label fw-bold">اسم الموديول</label>
                        <input type="text" class="form-control" name="module_name[]" required>
                      </div>
                      
                      <!-- Video Upload -->
                      <div class="mb-3">
                        <label class="form-label fw-bold">تحميل الفيديوهات</label>
                        <div class="input-group mb-2">
                          <input type="file" class="form-control" name="module_videos[]" multiple accept=".mp4,.mov,.avi">
                        </div>
                        <small class="text-muted">الصيغ المدعومة: MP4, MOV, AVI</small>
                      </div>
                      
                      <!-- Video Titles -->
                      <div class="mb-3">
                        <label class="form-label fw-bold">عناوين الفيديوهات</label>
                        <div class="video-titles-container">
                          <div class="input-group mb-2">
                            <input type="text" class="form-control" name="video_title_0" placeholder="أدخل عنوان الفيديو">
                            <button type="button" class="btn btn-outline-primary add-title-btn">
                              <i class="fas fa-plus"></i>
                            </button>
                          </div>
                        </div>
                        <input type="hidden" name="video_title_count" value="1">
                        <small class="text-muted">أضف عنواناً لكل فيديو</small>
                      </div>
                      
                      <!-- Note -->
                      <div class="mb-3">
                        <label class="form-label fw-bold">الملاحظة <span class="text-danger">*</span></label>
                        <textarea class="form-control module-note" name="module_note[]" rows="3" required></textarea>
                      </div>
                      
                      <!-- Quiz -->
                      <div class="mb-3">
                        <label class="form-label fw-bold">الاختبار <span class="text-danger">*</span></label>
                        <div class="quiz-section">
                          <div class="questions-container">
                            <!-- Default question -->
                            <div class="question-card card mb-3">
                              <div class="card-body">
                                <div class="mb-3">
                                  <label class="form-label">السؤال</label>
                                  <input type="text" class="form-control" name="module_quiz_question[]" required>
                                </div>
                                <div class="answers-container">
                                  <!-- Default answers -->
                                  <div class="answer-group mb-2">
                                    <div class="input-group">
                                      <div class="input-group-text">
                                        <input type="radio" name="module_quiz_correct[]" value="0" required>
                                      </div>
                                      <input type="text" class="form-control" name="module_quiz_answer[]" required placeholder="الإجابة">
                                    </div>
                                  </div>
                                  <div class="answer-group mb-2">
                                    <div class="input-group">
                                      <div class="input-group-text">
                                        <input type="radio" name="module_quiz_correct[]" value="1" required>
                                      </div>
                                      <input type="text" class="form-control" name="module_quiz_answer[]" required placeholder="الإجابة">
                                    </div>
                                  </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary add-answer-btn mt-2">
                                  <i class="fas fa-plus me-1"></i>إضافة إجابة
                                </button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
              
              <div class="d-flex justify-content-center my-4">
                <button type="button" class="btn btn-success" id="add-module-btn">
                  <i class="fas fa-plus me-2"></i> إضافة موديول جديد
                </button>
              </div>
              
              <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary px-4" onclick="prevStep()">
                  <i class="fas fa-arrow-right me-2"></i> السابق
                </button>
                <button type="button" class="btn btn-primary px-4" onclick="nextStep()">
                  التالي <i class="fas fa-arrow-left ms-2"></i>
                </button>
              </div>
            </div>
            
            <!-- Step 3: Review -->
            <div class="step-card d-none">
              <h4 class="mb-4 text-primary">مراجعة الدورة</h4>
              
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                راجع معلومات الدورة قبل الحفظ. تأكد من إضافة جميع المعلومات المطلوبة.
              </div>
              
              <div class="course-summary mb-4">
                <h5 class="text-primary mb-3">ملخص الدورة</h5>
                <div class="card">
                  <div class="card-body">
                    <p><strong>عنوان الدورة:</strong> <span id="summary-title"></span></p>
                    <p><strong>الوصف المختصر:</strong> <span id="summary-small-desc"></span></p>
                    <p><strong>السعر:</strong> <span id="summary-price"></span></p>
                    <p><strong>المستوى:</strong> <span id="summary-level"></span></p>
                    <p><strong>عدد الموديولات:</strong> <span id="summary-modules"></span></p>
                  </div>
                </div>
              </div>
              
              <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary px-4" onclick="prevStep()">
                  <i class="fas fa-arrow-right me-2"></i> السابق
                </button>
                <button type="button" class="btn btn-success px-4" id="submit-course-btn">
                  <i class="fas fa-save me-2"></i> حفظ الدورة
                </button>
              </div>
            </div>
            
          </form>
        </div>
      </div>
    </div>

{% endblock dashboard_content %}